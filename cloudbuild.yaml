steps:
  - name: 'gcr.io/k8s-skaffold/skaffold'
    id: 'Build artifact'
    args:
      - 'skaffold'
      - 'build'
      - '--interactive=false'
      - '--build-image=frontend'
      - '--default-repo=${_DEFAULT_REPO}'
      - '--file-output=/workspace/artifacts.json'

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    id: 'Create release'
    entrypoint: gcloud
    args:
      [
        'deploy', 'releases', 'create', 'r-${SHORT_SHA}-$$DATE$$TIME',
        '--delivery-pipeline', 'microservices-frontend',
        '--region', '$_REGION',
        '--build-artifacts', '/workspace/artifacts.json'
      ]

options:
  logging: CLOUD_LOGGING_ONLY
